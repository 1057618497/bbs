<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.ITopicDao">
    <resultMap type="vo.Topic" id="Topic">
        <!-- 定义主键 ,非常重要。如果是多个字段,则定义多个id -->
        <!-- property：主键在pojo中的属性名 -->
        <!-- column：主键在数据库中的列名 -->
        <id property="tid" column="tid" />

        <!-- 定义普通属性 -->

        <result property="id" column="author_id" />
        <result property="upTime" column="uptime" />
        <result property="replyNum" column="reply" />
        <result property="clickNum" column="click" />
        <result property="rt" column="re_time" />
        <result property="recentReName" column="re_id" />
        <!--当然可以只写属性名和列名不一样的，一样的可以省略。id一样也可以省略-->
    </resultMap>
    <resultMap type="vo.BriefTopic" id="BriefTopic">
        <!-- 定义主键 ,非常重要。如果是多个字段,则定义多个id -->
        <!-- property：主键在pojo中的属性名 -->
        <!-- column：主键在数据库中的列名 -->
        <id property="id" column="tid" />

        <!-- 定义普通属性 -->
        <result property="type" column="require" />
        <result property="author" column="author_id" />
        <result property="t" column="uptime" />
        <result property="replyNum" column="reply" />
        <result property="clickNum" column="click" />
        <result property="rt" column="re_time" />
        <result property="recentReName" column="re_id" />
        <!--当然可以只写属性名和列名不一样的，一样的可以省略。id一样也可以省略-->
    </resultMap>
    <!--主贴id 获取主贴所有信息-->
    <select id="selectTopBytid" resultMap="Topic" parameterType="int">
            select * from topic,topic_info where topic.tid=topic_info.tid
            and topic.tid=#{_paramete}
    </select>
    <!--获取置顶帖子-->
    <select id="selectTopList" resultMap="BriefTopic">
        select topic.tid,author_id,uptime,
                re_id,re_time,
                click,reply,title,require
        from topic,topic_info,topic_re
        where
            topic.tid=topic_info.tid and topic_info.tid=topic_re.tid
            and add_top=1
    </select>
    <!-- 获取一页帖子-->
    <select id="selectList0" resultMap="BriefTopic" parameterType="vo.HomePage">
        select  top ${end}
                topic.tid,author_id,uptime,
                re_id,re_time,
                click,reply,title,require
        from topic,topic_info,topic_re
        where
            topic.tid=topic_info.tid and topic_info.tid=topic_re.tid
        <if test="tType!= 2">
            and require=#{tType}
        </if>
            ORDER BY upTime DESC
    </select>
    <select id="selectList1" resultMap="BriefTopic" resultType="vo.HomePage">
        select top ${end}
                topic.tid,author_id,uptime,
                re_id,re_time,
                click,reply,title,require
        from topic,topic_info,topic_re
        where
            topic.tid=topic_info.tid and topic_info.tid=topic_re.tid
            and require=#{tType}
            ORDER BY click DESC
    </select>
    <select id="selectList2" resultMap="BriefTopic" resultType="vo.HomePage">
        select top ${end}
                topic.tid,author_id,uptime,
                re_id,re_time,
                click,reply,title,require
        from topic,topic_info,topic_re
        where
            topic.tid=topic_info.tid and topic_info.tid=topic_re.tid
            and require=#{tType}
            ORDER BY reply DESC
    </select>
    <select id="selectList3" resultMap="BriefTopic" resultType="vo.HomePage">
        select top ${end}
                topic.tid,author_id,uptime,
                re_id,re_time,
                click,reply,title,require
        from topic,topic_info,topic_re
        where
            topic.tid=topic_info.tid and topic_info.tid=topic_re.tid
            and require=#{tType}
            ORDER BY re_time DESC
    </select>
    <!-- 相应帖子数量-->
    <select id="totalNum" resultType="int" >
        SELECT count(*) from topic_info
    </select>
    <select id="totalNum_re" resultType="int" parameterType="int">
        SELECT count(*) from topic_info where require=#{tType}
    </select>




    <select id="test" resultType="String" parameterType="int">
        SELECT uptime from topic where tid = #{id}
    </select>

    <!-- 楼主信息-->
    <insert id="insertTopic_t" parameterType="vo.Topic" useGeneratedKeys="true" keyProperty="tid">
        insert into topic values(#{id}, #{upTime})
    </insert>
    <!-- 最新回帖信息-->
    <insert id="insertTopic_r" parameterType="vo.Topic">
        insert into topic_re values(#{tid},#{id}, #{upTime})
    </insert>
    <!-- 主贴信息-->
    <insert id="insertTopic_info" parameterType="vo.Topic" >
        insert into topic_info values(#{tid}, 0,0,#{title},#{content},
        0,0,#{require},#{points})
    </insert>

</mapper>
